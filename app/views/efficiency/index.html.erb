<%= render :partial => 'common/header' %>
<%= include_calendar_headers_tags %>
<%= heads_for_wiki_formatter %>
<% content_for :header_tags do %>
  <%= javascript_include_tag 'fixed_header.js', :plugin => 'management' %>
  <%= stylesheet_link_tag 'facebox', :plugin => 'facebox_render' %>
  <%= javascript_include_tag 'facebox.js', :plugin => 'facebox_render' %>
<% end %>

<h2>Efficiency</h2>
<p><strong>CLIENT:</strong> <%= @project.client %></p>

<table class="list" style="text-align: center">
  <thead>
    <tr>
      <th></th>
      <th>Defects<br/> Raised</th>
      <th>Defects<br/> Open</th>
      <th>Defects<br/> Resolved/For Verification</th>
      <th>Defects<br/> Closed</th>
    </tr>
  </thead>
  <tbody>
    <tr class="even">
      <td class="left">Start to Current</td>
      <td><%= bug_count %></td>
      <td><%= bug_count :open %></td>
      <td><%= bug_count :resolved %></td>
      <td><%= bug_count :closed %></td>
    </tr>
    <% @versions.each do |version| %>
      <tr class="<%= cycle 'odd', 'even' %>">
        <td class="left"><%= version.name %></td>
        <td><%= bug_count nil, version %></td>
        <td><%= bug_count :open, version %></td>
        <td><%= bug_count :resolved, version %></td>
        <td><%= bug_count :closed, version %></td>
      </tr>
    <% end %>
  </tbody>
</table>

<div id="efficiency_chart">
</div>

<% content_for :header_tags do %>
  <%= stylesheet_link_tag 'jquery.jqplot.css', :plugin => 'redmine_burndown' %>
  <%= javascript_include_tag 'jquery.jqplot.js', :plugin => 'redmine_burndown' %>
  <%= javascript_include_tag 'plugins/jqplot.canvasAxisLabelRenderer.min.js', :plugin => 'redmine_burndown' %>
  <%= javascript_include_tag 'plugins/jqplot.canvasAxisTickRenderer.min.js', :plugin => 'redmine_burndown' %>
  <%= javascript_include_tag 'plugins/jqplot.canvasTextRenderer.min.js', :plugin => 'redmine_burndown' %>
  <%= javascript_include_tag 'plugins/jqplot.categoryAxisRenderer.min.js', :plugin => 'redmine_burndown' %>
  <%= javascript_include_tag 'plugins/jqplot.cursor.min.js', :plugin => 'redmine_burndown' %>
  <%= javascript_include_tag 'plugins/jqplot.dateAxisRenderer.min.js', :plugin => 'redmine_burndown' %>
  <%= javascript_include_tag 'plugins/jqplot.highlighter.min.js', :plugin => 'redmine_burndown' %>
  <%= javascript_include_tag 'plugins/jqplot.pointLabels.min.js', :plugin => 'redmine_burndown' %>
  <script type="text/javascript">
    jQuery(document).ready(function() {
      jQuery.jqplot('efficiency_chart', <%= chart_data.to_json %>, {
        axes: {
          xaxis: {label: 'Weeks', autoscale: true, renderer: jQuery.jqplot.DateAxisRenderer, tickRenderer: jQuery.jqplot.CanvasAxisTickRenderer, tickOptions: {showMark: false, fontSize: '8pt', formatString: '%m/%d/%y', angle: -30}},
          yaxis: {min: 0, tickOptions: {formatString:'%d'}}
        },
        seriesColors: ['#ff0000', '#009900'],
        series: {label: 'Raised'},
        legend: {show: false},
        cursor: {show: true, zoom: true},
        highlighter: {show: true, sizeAdjust: 7.5}
      });
    });
  </script>
<% end %>
